import Guide from '~/components/layout/guide'
import Snippet from '~/components/snippet'
import { Image } from '~/components/media'
import Caption from '~/components/text/caption'
import Link from '~/components/text/link'
import Note from '~/components/text/note'
import { InlineCode } from '~/components/text/code'
import Step1 from '~/components/custom-domains-mdx/select-project.mdx'
import Step2 from '~/components/custom-domains-mdx/navigate-to-settings.mdx'
import Step3 from '~/components/custom-domains-mdx/enter-domain.mdx'

export const meta = {
  title: 'Zero-Downtime Domain Migration with ZEIT Now',
  description:
    'Migrate your domain from an external service to ZEIT Now with no downtime, in just a few steps.',
  published: '2019-07-11T17:00:00.860Z',
  authors: ['msweeneydev'],
  url: '/guides/zero-downtime-domain-migration',
  editUrl: 'pages/guides/zero-downtime-domain-migration.mdx',
  lastEdited: '2020-04-01T10:58:53.000Z'
}

**Who this guide is for**: Your domain is using an external DNS provider, and you’d like to switch it to use ZEIT’s DNS instead.

When migrating nameservers, there can often be downtime incurred. In this guide, we will walk you through adding your domain to ZEIT and setting it up before migrating the nameservers, ensuring no downtime at any point.

## Step 1: Import Your Project to ZEIT Now

If you haven’t done so already, [import](/import) the project that’s currently using your domain into ZEIT Now. We recommend importing using [our Git integrations](/docs/v2/git-integrations).

## Step 2: Add Your Domain to Your Project

Next, add your domain to your project.

### Selecting Your Project

<Step1 />

### Navigating to Domain Settings

<Step2 />

### Entering Your Chosen Domain

<Step3 />

## Step 3: Copy DNS Records

Once your domain is added, you need to **copy over all the DNS records** from your existing DNS provider.

To do this, you first need to:

- [Download and install Now CLI](/download),
- [Log in](/docs/now-cli#commands/login) (`now login`), and
- [Switch](/docs/now-cli#commands/switch) (`now switch`) to the account or team that owns the project you added.

Then, **copy over all the DNS records** from your existing DNS provider using the `now dns add` command ([documentation](/docs/now-cli#commands/dns)).

<Snippet
  dark
  text="now dns add [domain] [subdomain] [A || AAAA || ALIAS || CNAME || TXT] [value]"
/>

For example, if your existing DNS provider has MX records for Google Apps, you can run a command like below. You can use `@` for `[subdomain]` for the root domain.

<Snippet
  dark
  prompt={false}
  text={`now dns add example.com @ MX ASPMX.L.GOOGLE.COM 1\nnow dns add example.com @ MX ALT1.ASPMX.L.GOOGLE.COM 5\nnow dns add example.com @ MX ALT2.ASPMX.L.GOOGLE.COM 5\nnow dns add example.com @ MX ALT3.ASPMX.L.GOOGLE.COM 10\nnow dns add example.com @ MX ALT4.ASPMX.L.GOOGLE.COM 10`}
/>

## Step 4: Moving the Nameservers

Once all the DNS records are added using `now dns add`, you may migrate the nameservers.

To do so, go to your project’s domain settings section again and find the list of **intended nameservers** and copy them.

<Image
  src={`${process.env.ASSETS}/docs/custom-domains/intended-nameservers.png`}
  width={682 / 2}
  height={294 / 2}
  shadow
/>
<Caption>Intended nameservers for your domain.</Caption>

Then, on your current domain provider, **set the nameservers as listed above**.

## Step 5: Remove the DNS Record for Your Project’s Domain

If one of the DNS records you’ve copied in step 3 was for your project’s domain, then you may remove that DNS record. This DNS record should no longer be used because by setting nameservers, your domain will correctly point to your project.

For example:

- Suppose that your project URL is `example.com`, and you might have copied over an ALIAS or ANAME record. If you did, you may remove this record at this step.
- Suppose that your project URL is `foo.example.com`, and you might have copied over a CNAME record for `foo.example.com`. If you did, you may remove this record at this step.

To remove the record, run `now dns ls` to get the `id` of your record:

<Snippet dark text="now dns ls" />

Then, remove the record using `now dns rm`:

<Snippet dark text="now dns rm" />

That’s it! Your domain is now using ZEIT’s DNS and no downtime should have incurred.

export default ({ children }) => <Guide meta={meta}>{children}</Guide>

export const config = {
  amp: 'hybrid'
}
